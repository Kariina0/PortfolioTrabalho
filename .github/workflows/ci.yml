name: CI - Validação HTML

on:
  pull_request:
    branches: [ "main" ]
  push:
    branches: [ "main" ]

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do código
        uses: actions/checkout@v4

      # 1. Falhar se o arquivo principal não for index.html
      - name: Verificar nome do arquivo HTML principal
        run: |
          if ls *.html | grep -v "^index.html$"; then
            echo "ERRO: O arquivo HTML deve se chamar exatamente index.html"
            exit 1
          fi

      # 2. Instalar HTML Linter
      - name: Instalar HTMLHint
        run: npm install -g htmlhint

      # 3. Executar Linter no HTML
      - name: Executar Linter HTML
        run: |
          htmlhint index.html

      # 4. Bloquear arquivos maiores que 500KB
      - name: Verificar tamanho máximo dos arquivos (500KB)
        run: |
          if find . -type f -size +500k | grep .; then
            echo "ERRO: Arquivo(s) maior(es) que 500KB encontrado(s)"
            exit 1
          fi

      # 5. Bloquear termos proibidos
      - name: Varredura de termos proibidos
        run: |
          if grep -RniE "TODO|FIXME|senha|password" .; then
            echo "ERRO: Termos proibidos encontrados no código"
            exit 1
          fi

      # 6. Verificar links e imagens inválidos
      - name: Verificar links e imagens inválidos
        run: |
          npm install -g broken-link-checker
          blc index.html --recursive --filter-level=3
